import streamlit as st
from utils.market import get_price_history
import pandas as pd

# Configura칞칚o da p치gina
st.set_page_config(page_title="An치lise de Ativos", page_icon="游늳")

st.title("游늳 An치lise de Ativos Reais")
st.markdown("""
Nesta se칞칚o, voc칡 pode buscar o hist칩rico de pre칞os diretamente da bolsa de valores.
""")

# Barra lateral espec칤fica desta p치gina
st.sidebar.header("Configura칞칚o da Busca")
ticker = st.sidebar.text_input("Ticker do Ativo (ex: PETR4.SA, IVVB11.SA, AAPL)", value="PETR4.SA")
periodo = st.sidebar.selectbox("Per칤odo de An치lise", options=["1y", "2y", "5y", "10y", "max"], index=2)

st.divider()

# Bot칚o para disparar a busca
if st.sidebar.button("Consultar Dados"):
    with st.spinner(f"Buscando dados de {ticker}..."):
        dados = get_price_history(ticker, period=periodo)

        if dados is not None and not dados.empty:
            # C치lculos R치pidos
            preco_atual = dados.iloc[-1]
            preco_inicial = dados.iloc[0]
            variacao = ((preco_atual / preco_inicial) - 1) * 100

            # M칠tricas
            c1, c2 = st.columns(2)
            c1.metric("Pre칞o Atual", f"R$ {preco_atual:.2f}")
            c2.metric("Varia칞칚o no Per칤odo", f"{variacao:.2f}%", delta=f"{variacao:.2f}%")

            # Gr치fico Principal
            st.subheader(f"Evolu칞칚o Hist칩rica - {ticker}")
            st.line_chart(dados)
            
            # Tabela de Dados (opcional, recolhida)
            with st.expander("Ver tabela de pre칞os detalhada"):
                st.dataframe(dados)
        else:
            st.error(f"N칚o foi poss칤vel encontrar dados para o ticker '{ticker}'. Verifique se ele existe e tente novamente.")
else:
    st.info("Digite um ticker na barra lateral e clique em 'Consultar Dados' para come칞ar.")

st.sidebar.markdown("---")
st.sidebar.caption("Dados fornecidos via Yahoo Finance API.")
